(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{2634:()=>{},7681:(e,t,a)=>{Promise.resolve().then(a.bind(a,1002))},1002:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eN});var s=a(5155),r=a(2115),l=a(4920),n=a(9602);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.bL,{ref:t,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...r})});i.displayName=l.bL.displayName;let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l._V,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",a),...r})});o.displayName=l._V.displayName;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.H4,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...r})});d.displayName=l.H4.displayName;var c=a(4085),m=a(371),u=a(767),f=a(8867),h=a(4505),p=a(3920),x=a(872),g=a(241);function y(e){let{onEdit:t,isThinking:a,isError:l,content:y,role:j,time:b}=e,[v,N]=(0,r.useState)(!1),[w,C]=(0,r.useState)(y||"");return(0,s.jsx)("div",{className:"flex ".concat("user"===j?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"flex items-start space-x-2 max-w-[80%] sm:max-w-[70%] md:max-w-[60%]",children:["assistant"===j&&(0,s.jsxs)(i,{className:"w-8 h-8 hidden sm:flex",children:[(0,s.jsx)(o,{src:"/placeholder.svg?height=32&width=32",alt:"AI"}),(0,s.jsx)(d,{children:"AI"})]}),(0,s.jsx)("div",{className:(0,n.cn)("p-3 rounded-lg shadow relative group","user"===j?"bg-blue-100":"bg-gray-100",a&&"animate-pulse",l&&"bg-red-50 border border-red-200"),children:v?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m.T,{value:w,onChange:e=>C(e.target.value),className:"min-h-[100px] w-full resize-none",autoFocus:!0}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsxs)(c.$,{size:"sm",variant:"outline",onClick:()=>{C(y),N(!1)},children:[(0,s.jsx)(u.A,{className:"w-4 h-4 mr-1"}),"取消"]}),(0,s.jsxs)(c.$,{size:"sm",onClick:()=>{w.trim()!==y&&(null==t||t(y,w)),N(!1)},children:[(0,s.jsx)(f.A,{className:"w-4 h-4 mr-1"}),"保存"]})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[a&&(0,s.jsx)(h.A,{className:"w-4 h-4 animate-spin text-gray-500"}),(0,s.jsx)("p",{className:(0,n.cn)("whitespace-pre-wrap break-words",l&&"text-red-500"),children:y})]}),!a&&!l&&(0,s.jsxs)("div",{className:"absolute -bottom-8 right-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center space-x-1 bg-white rounded-md shadow-sm p-1",children:[(0,s.jsx)(c.$,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"复制",onClick:()=>{navigator.clipboard.writeText(y),(0,g.oR)({title:"复制成功"})},children:(0,s.jsx)(p.A,{className:"w-4 h-4"})}),"assistant"!=j&&(0,s.jsx)(c.$,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"编辑",onClick:()=>N(!0),children:(0,s.jsx)(x.A,{className:"w-4 h-4"})})]})]})})]})})}var j=a(8283);function b(e){let{input:t,disabled:a,onChange:l,onSend:n}=e,[i,o]=(0,r.useState)(3),d=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(d.current){let e=d.current,t=parseInt(getComputedStyle(e).lineHeight),a=parseInt(getComputedStyle(e).paddingTop),s=parseInt(getComputedStyle(e).paddingBottom);e.style.height="auto";let r=Math.min(8,Math.max(1,Math.ceil((e.scrollHeight-a-s)/t)));o(r),r>=8?e.style.overflowY="auto":e.style.overflowY="hidden"}},[t]),(0,s.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,s.jsx)(m.T,{ref:d,value:t,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),n())},placeholder:"Type your message...",className:"flex-1 resize-none",rows:i,disabled:a}),(0,s.jsx)(c.$,{onClick:n,size:"icon",className:"mb-1",disabled:a,children:(0,s.jsx)(j.A,{className:"w-4 h-4"})})]})}var v=a(3392),N=a(6899),w=a(5683);function C(e){let{id:t,content:a,isSelected:l,setSelectedCard:n}=e,[i,o]=(0,r.useState)(!1);return(0,s.jsx)(N.P.div,{className:"border rounded-lg p-4 h-full flex flex-col",onClick:()=>{o(!i),n(i?null:t)},children:(0,s.jsx)(w.N,{children:(0,s.jsx)(N.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"mt-2",children:(0,s.jsx)("p",{className:"text-sm break-all",children:a})})})})}function k(e){let{title:t,results:a,selectedCard:r,setSelectedCard:l}=e;return(0,s.jsxs)(N.P.div,{className:"p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:t}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map((e,a)=>(0,s.jsx)(C,{id:"".concat(t,"-").concat(a),content:e,isSelected:r==="".concat(t,"-").concat(a),setSelectedCard:l},"".concat(t,"-").concat(a)))})]})}function _(e){let{result:t}=e;return(0,s.jsxs)(N.P.div,{className:"p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"最佳匹配结果"}),(0,s.jsx)(v.F,{className:"h-48 rounded-md border p-4",children:(0,s.jsx)("p",{className:"text-sm",children:t})})]})}function S(e){let{messages:t,input:a,onInputChange:l,onSend:n,recallResults:i,selectedCard:o,setSelectedCard:d,isLoading:c=!1}=e,m=(0,r.useRef)(null),u=(0,r.useRef)(null),f=()=>{var e;null===(e=u.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};return(0,r.useEffect)(()=>{f()},[t]),(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)(v.F,{className:"flex-1 px-4 py-1",children:(0,s.jsxs)("div",{ref:m,children:[i&&(0,s.jsxs)("div",{className:"mx-auto space-y-4",children:[(0,s.jsx)(k,{title:"召回结果",results:(null==i?void 0:i.recall_msg)||[],selectedCard:o,setSelectedCard:d}),(0,s.jsx)(_,{result:(null==i?void 0:i.match_best)||""})]}),(0,s.jsx)("div",{className:"mx-auto space-y-4",children:t.map((e,t)=>(0,s.jsx)(y,{content:e.content,role:e.role},t))}),(0,s.jsx)("div",{ref:u})]})}),(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("div",{className:"mx-auto",children:(0,s.jsx)(b,{input:a,onChange:l,onSend:n,disabled:c})})})]})}var R=a(7782),A=a(1027);let I=R.bL,z=R.l9;R.bm;let T=R.ZL,F=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(R.hJ,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});F.displayName=R.hJ.displayName;let D=(0,A.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),E=r.forwardRef((e,t)=>{let{side:a="right",className:r,children:l,...i}=e;return(0,s.jsxs)(T,{children:[(0,s.jsx)(F,{}),(0,s.jsxs)(R.UC,{ref:t,className:(0,n.cn)(D({side:a}),r),...i,children:[(0,s.jsxs)(R.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]}),l]})]})});E.displayName=R.UC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(R.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold text-foreground",a),...r})}).displayName=R.hE.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(R.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})}).displayName=R.VY.displayName;var O=a(3473),L=a(6710),P=a(4858),M=a(4834),V=a(5686),q=a(750),$=a(9246);function U(e){let{chat:t,onDelete:a,onClick:r,onRecall:l,isSelected:n,isDisabled:i}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-3 flex items-center justify-between hover:shadow-md transition-shadow group cursor-pointer w-[180px] ".concat(n?"bg-[#e8e8ea]":""),onClick:()=>r(t),children:[(0,s.jsx)($.TooltipProvider,{children:(0,s.jsxs)($.m_,{children:[(0,s.jsx)($.k$,{asChild:!0,children:(0,s.jsx)("span",{className:"font-medium truncate flex-1 text-left",children:t.query})}),(0,s.jsx)($.ZI,{children:(0,s.jsx)("p",{children:t.query})})]})}),(0,s.jsxs)(q.rI,{children:[(0,s.jsx)(q.ty,{asChild:!0,children:(0,s.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 transition-opacity duration-200 ml-2 flex-shrink-0",children:(0,s.jsx)(P.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(q.SQ,{children:[(0,s.jsxs)(q._2,{onClick:e=>{e.stopPropagation(),l(t)},className:"hover:text-orange-500",children:[(0,s.jsx)(M.A,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"召回"})]}),(0,s.jsxs)(q._2,{onClick:e=>{e.stopPropagation(),a(t)},className:"!text-red-600",children:[(0,s.jsx)(V.A,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"删除"})]})]})]})]})}var J=a(7837),B=a(3415),Z=a(2679),K=a(9606),Y=a(2317),H=a(5785);let G=K.Op,Q=r.createContext({}),X=e=>{let{...t}=e;return(0,s.jsx)(Q.Provider,{value:{name:t.name},children:(0,s.jsx)(K.xI,{...t})})},W=()=>{let e=r.useContext(Q),t=r.useContext(ee),{getFieldState:a,formState:s}=(0,K.xW)(),l=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:n}=t;return{id:n,name:e.name,formItemId:"".concat(n,"-form-item"),formDescriptionId:"".concat(n,"-form-item-description"),formMessageId:"".concat(n,"-form-item-message"),...l}},ee=r.createContext({}),et=r.forwardRef((e,t)=>{let{className:a,...l}=e,i=r.useId();return(0,s.jsx)(ee.Provider,{value:{id:i},children:(0,s.jsx)("div",{ref:t,className:(0,n.cn)("space-y-2",a),...l})})});et.displayName="FormItem";let ea=r.forwardRef((e,t)=>{let{className:a,...r}=e,{error:l,formItemId:i}=W();return(0,s.jsx)(H.J,{ref:t,className:(0,n.cn)(l&&"text-destructive",a),htmlFor:i,...r})});ea.displayName="FormLabel";let es=r.forwardRef((e,t)=>{let{...a}=e,{error:r,formItemId:l,formDescriptionId:n,formMessageId:i}=W();return(0,s.jsx)(Y.DX,{ref:t,id:l,"aria-describedby":r?"".concat(n," ").concat(i):"".concat(n),"aria-invalid":!!r,...a})});es.displayName="FormControl",r.forwardRef((e,t)=>{let{className:a,...r}=e,{formDescriptionId:l}=W();return(0,s.jsx)("p",{ref:t,id:l,className:(0,n.cn)("text-[0.8rem] text-muted-foreground",a),...r})}).displayName="FormDescription";let er=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e,{error:i,formMessageId:o}=W(),d=i?String(null==i?void 0:i.message):r;return d?(0,s.jsx)("p",{ref:t,id:o,className:(0,n.cn)("text-[0.8rem] font-medium text-destructive",a),...l,children:d}):null});er.displayName="FormMessage";var el=a(2336);let en=B.Ik({value:B.Yj().min(1,"请输入召回内容")}),ei=(0,r.forwardRef)((e,t)=>{let{onSubmit:a,defaultValues:r}=e,l=(0,K.mN)({resolver:(0,Z.u)(en),defaultValues:{value:"",...r}});return(0,s.jsx)(G,{...l,children:(0,s.jsx)("form",{ref:t,onSubmit:l.handleSubmit(a),className:"space-y-4",children:(0,s.jsx)(X,{control:l.control,name:"value",render:e=>{let{field:t}=e;return(0,s.jsxs)(et,{children:[(0,s.jsx)(ea,{className:"required",children:"召回内容"}),(0,s.jsx)(es,{children:(0,s.jsx)(el.p,{placeholder:"请输入想要了解的内容",...t})}),(0,s.jsx)(er,{})]})}})})})});function eo(e){let{isOpen:t,onClose:a,knowledgeBase:l,onSubmit:n,isLoading:i}=e,o=(0,r.useRef)(null);return(0,s.jsx)(J.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(J.Cf,{className:"max-w-2xl",children:[(0,s.jsxs)(J.c7,{children:[(0,s.jsx)(J.L3,{children:"创建聊天"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"这里，为您的专属知识库打造一个专属助手！ \uD83D\uDC95"})]}),(0,s.jsxs)("p",{children:["选中的知识库: ",null==l?void 0:l.name]}),(0,s.jsx)(ei,{ref:o,onSubmit:n}),(0,s.jsx)(J.Es,{children:(0,s.jsxs)("div",{className:"flex justify-end gap-4 pt-4",children:[(0,s.jsx)(c.$,{type:"button",variant:"outline",onClick:a,children:"取消"}),(0,s.jsx)(c.$,{type:"button",onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.requestSubmit()},disabled:i,children:i?(0,s.jsxs)(N.P.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2",children:[(0,s.jsx)(h.A,{className:"animate-spin"}),(0,s.jsx)("span",{children:"创建中..."})]}):"创建"})]})})]})})}function ed(e){let{knowledgeBases:t,selectedKnowledgeBase:a,onSelectKnowledgeBase:r}=e;return(0,s.jsxs)("div",{className:"w-2/5 mr-2",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold mb-2",children:"知识库"}),(0,s.jsx)(v.F,{className:"h-[calc(100vh-10rem)]",children:(0,s.jsx)("div",{className:"space-y-1",children:t.map(e=>(0,s.jsx)(c.$,{variant:"ghost",className:"h-12 border w-full justify-start ".concat((null==a?void 0:a.name)===e.name?"bg-[#e8e8ea]":""),onClick:()=>r(e),children:e.name},e.name))})})]})}ei.displayName="ChatRecallForm";var ec=a(3543);function em(e){let{chats:t,knowledgeBases:a,selectedKnowledgeBase:r,createChatLoading:l,onSelectKnowledgeBase:n,onChatClick:i,onDeleteChat:o,onRecallChat:d,onCreateChat:m,selectedChat:u,getChatsLoading:f,isChatRecallDialogOpen:p,setIsChatRecallDialogOpen:x}=e,y=()=>{r?x(!0):(0,g.oR)({title:"请先选择一个知识库",description:"请先选择一个知识库"})},j=e=>{n(e)},b=e=>{i(e)},N=()=>(0,s.jsx)("div",{className:"flex flex-col h-full p-4",children:(0,s.jsxs)("div",{className:"flex flex-grow overflow-hidden",children:[(0,s.jsx)(ed,{knowledgeBases:a,selectedKnowledgeBase:r,onSelectKnowledgeBase:j}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold mb-2",children:"聊天记录"}),f?(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)(h.A,{className:"animate-spin"})}):(0,s.jsx)(v.F,{className:"flex-1 px-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("button",{onClick:y,disabled:!r||l||f,className:"w-[180px] p-3 flex items-center gap-2 rounded-lg border border-dashed \n                  ".concat(!r||l||f?"text-gray-400 border-gray-200 cursor-not-allowed":"text-gray-600 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-colors"),children:[(0,s.jsx)(O.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"text-sm",children:"创建新对话"})]}),t.map(e=>(0,s.jsx)(U,{chat:e,onDelete:o,onClick:b,onRecall:d,isSelected:(null==u?void 0:u.search_id)===e.search_id,isDisabled:!r},e.search_id))]})})]})]})});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"hidden lg:block w-96 border-r border-gray-200 h-full overflow-hidden",children:(0,s.jsx)(N,{})}),(0,s.jsx)(eo,{isOpen:p,onClose:()=>x(!1),knowledgeBase:r,onSubmit:m,isLoading:l}),(0,s.jsxs)(I,{children:[(0,s.jsx)(z,{asChild:!0,children:(0,s.jsx)(c.$,{variant:"ghost",className:"lg:hidden absolute left-4 top-1/2 -translate-y-1/2 z-50",size:"icon",children:(0,s.jsx)(L.A,{className:"h-6 w-6"})})}),(0,s.jsxs)(E,{side:"left",className:"sm:max-w-none p-0 w-4/5",children:[(0,s.jsx)(J.c7,{children:(0,s.jsx)(J.L3,{children:(0,s.jsx)(ec.s,{children:"侧边栏菜单"})})}),(0,s.jsx)(N,{})]})]})]})}var eu=a(2120),ef=a(1973),eh=a.n(ef);let ep=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await eu.A.get("/knowledgebase/search_history_list?".concat(eh().stringify(e)))).data}catch(e){throw console.error("Failed to fetch knowledge list:",e),e}},ex=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await eu.A.post("/knowledgebase/search_history_delete",e)).data}catch(e){throw console.error("Failed to fetch knowledge list:",e),e}},eg=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await eu.A.get("/knowledgebase/search_history_detail?".concat(eh().stringify(e)))).data}catch(e){throw console.error("Failed to fetch knowledge list:",e),e}},ey=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await eu.A.get("/knowledgebase/history_chat_list?".concat(eh().stringify(e)))).data}catch(e){throw console.error("Failed to fetch knowledge list:",e),e}},ej=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await eu.A.get("/knowledgebase/recall?".concat(eh().stringify(e)))).data}catch(e){throw console.error("Failed to fetch knowledge list:",e),e}},eb=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await eu.A.post("/llm/generate",e)).data}catch(e){throw console.error("Failed to generate llm:",e),e}},ev=["思考中","思考中.","思考中..","思考中..."];function eN(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),[n,i]=(0,r.useState)(null),[o,d]=(0,r.useState)(null),[c,m]=(0,r.useState)([]),[u,f]=(0,r.useState)(""),[h,p]=(0,r.useState)(null),[x,y]=(0,r.useState)(null),[j,b]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),[w,C]=(0,r.useState)(!1),[k,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{var e;let t=JSON.parse(window.localStorage.getItem("knowledge_bases")||"[]");l(t),p(t[0]),A(null===(e=t[0])||void 0===e?void 0:e.name)},[]);let R=(0,r.useCallback)(async()=>{if(!u.trim())return;C(!0);let e={id:Date.now(),content:u,role:"user"};m(t=>[...t,e]);let t=Date.now()+1;m(e=>[...e,{id:t,content:ev[0],role:"assistant",isThinking:!0}]),f("");let a=0,s=setInterval(()=>{a=(a+1)%ev.length,m(e=>e.map(e=>e.id===t?{...e,content:ev[a]}:e))},500);try{let e={search_id:null==x?void 0:x.search_id,instruction:u,text:null==n?void 0:n.match_best},a=(await eb(e)).data||"抱歉，我没有找到合适的回答";console.log("回答结果：",a),clearInterval(s);let r=Date.now()+2;m(e=>[...e.filter(e=>e.id!==t),{id:r,content:"",role:"assistant"}]);let l=async()=>{let e="";for(let t=0;t<a.length;t+=2)await new Promise(e=>setTimeout(e,30)),e+=a.slice(t,t+2),m(t=>t.map(t=>t.id===r?{...t,content:e}:t))};await l()}catch(e){clearInterval(s),m(e=>[...e.filter(e=>e.id!==t),{id:Date.now()+2,content:"抱歉，发生了一些错误，请稍后重试。",role:"assistant",isError:!0}])}finally{C(!1)}},[u,n]),A=(0,r.useCallback)(e=>{N(!0),ep({name:e}).then(e=>{200===e.code?t(e.data):(0,g.oR)({title:"获取聊天列表失败",description:e.msg})}).finally(()=>{N(!1)})},[]),I=(0,r.useCallback)(e=>{y(e),D(e.search_id),F(e.search_id)},[]),z=(0,r.useCallback)(e=>{ex({name:e.collection_name,query:e.query}).then(e=>{200===e.code?(0,g.oR)({title:"删除聊天成功",description:e.msg}):(0,g.oR)({title:"删除聊天失败",description:e.msg})}).finally(()=>{A(e.collection_name)})},[A]),T=(0,r.useCallback)(e=>{ej({name:e.collection_name,query:e.query,is_new:!0}).then(e=>{200===e.code?(i(e.data),(0,g.oR)({title:"重新召回成功",description:e.msg})):(0,g.oR)({title:"重新召回失败",description:e.msg})})},[]),F=(0,r.useCallback)(e=>{ey({search_id:e}).then(e=>{200===e.code?m(e.data.reduce((e,t)=>[...e,...t.chat],[])):(0,g.oR)({title:"获取聊天信息失败",description:e.msg})})},[]),D=(0,r.useCallback)(e=>{eg({search_id:e,page:1,page_size:20}).then(e=>{200===e.code?i(e.data):(0,g.oR)({title:"获取召回信息失败",description:e.msg})})},[]),E=(0,r.useCallback)(e=>{p(e),A(e.name)},[A]),O=(0,r.useCallback)(e=>{b(!0),ej({name:null==h?void 0:h.name,query:e.value}).then(e=>{200===e.code?((0,g.oR)({title:"创建成功",description:"创建成功"}),A((null==h?void 0:h.name)||""),D(e.data.search_id),F(e.data.search_id),y(e.data),_(!1)):(0,g.oR)({title:"创建失败",description:e.msg})}).finally(()=>{b(!1)})},[h,A,D,F]);return(0,s.jsxs)("div",{className:"flex h-full",children:[(0,s.jsx)(em,{knowledgeBases:a,chats:e,createChatLoading:j,getChatsLoading:v,selectedKnowledgeBase:h,selectedChat:x,onSelectKnowledgeBase:E,onChatClick:I,onDeleteChat:z,onRecallChat:T,onCreateChat:O,isChatRecallDialogOpen:k,setIsChatRecallDialogOpen:_}),(0,s.jsx)("main",{className:"flex-1 overflow-hidden",children:(0,s.jsx)(S,{messages:c,input:u,onInputChange:f,onSend:R,recallResults:n,selectedCard:o,setSelectedCard:d,isLoading:w})})]})}},4085:(e,t,a)=>{"use strict";a.d(t,{$:()=>d,r:()=>o});var s=a(5155),r=a(2115),l=a(2317),n=a(1027),i=a(9602);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:a,variant:r,size:n,asChild:d=!1,...c}=e,m=d?l.DX:"button";return(0,s.jsx)(m,{className:(0,i.cn)(o({variant:r,size:n,className:a})),ref:t,...c})});d.displayName="Button"},7837:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>u,Es:()=>h,L3:()=>p,c7:()=>f,lG:()=>o,rr:()=>x,zM:()=>d});var s=a(5155),r=a(2115),l=a(7782),n=a(767),i=a(9602);let o=l.bL,d=l.l9,c=l.ZL;l.bm;let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});m.displayName=l.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:a,children:r,...o}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(m,{}),(0,s.jsxs)(l.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o,children:[r,(0,s.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(n.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=l.UC.displayName;let f=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};f.displayName="DialogHeader";let h=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};h.displayName="DialogFooter";let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});p.displayName=l.hE.displayName;let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...r})});x.displayName=l.VY.displayName},750:(e,t,a)=>{"use strict";a.d(t,{SQ:()=>u,_2:()=>f,rI:()=>c,ty:()=>m});var s=a(5155),r=a(2115),l=a(3125),n=a(6967),i=a(8867),o=a(3565),d=a(9602);let c=l.bL,m=l.l9;l.YJ,l.ZL,l.Pb,l.z6,r.forwardRef((e,t)=>{let{className:a,inset:r,children:i,...o}=e;return(0,s.jsxs)(l.ZP,{ref:t,className:(0,d.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...o,children:[i,(0,s.jsx)(n.A,{className:"ml-auto"})]})}).displayName=l.ZP.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.G5,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=l.G5.displayName;let u=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(l.ZL,{children:(0,s.jsx)(l.UC,{ref:t,sideOffset:r,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});u.displayName=l.UC.displayName;let f=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(l.q7,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",r&&"pl-8",a),...n})});f.displayName=l.q7.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:n,...o}=e;return(0,s.jsxs)(l.H_,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...o,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.VF,{children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})}),r]})}).displayName=l.H_.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(l.hN,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.VF,{children:(0,s.jsx)(o.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=l.hN.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(l.JU,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...n})}).displayName=l.JU.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=l.wv.displayName},2336:(e,t,a)=>{"use strict";a.d(t,{p:()=>n});var s=a(5155),r=a(2115),l=a(9602);let n=r.forwardRef((e,t)=>{let{className:a,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:(0,l.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});n.displayName="Input"},5785:(e,t,a)=>{"use strict";a.d(t,{J:()=>d});var s=a(5155),r=a(2115),l=a(6195),n=a(1027),i=a(9602);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.b,{ref:t,className:(0,i.cn)(o(),a),...r})});d.displayName=l.b.displayName},3392:(e,t,a)=>{"use strict";a.d(t,{F:()=>i});var s=a(5155),r=a(2115),l=a(1868),n=a(9602);let i=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,s.jsxs)(l.bL,{ref:t,className:(0,n.cn)("relative overflow-hidden",a),...i,children:[(0,s.jsx)(l.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,s.jsx)(o,{}),(0,s.jsx)(l.OK,{})]})});i.displayName=l.bL.displayName;let o=r.forwardRef((e,t)=>{let{className:a,orientation:r="vertical",...i}=e;return(0,s.jsx)(l.VM,{ref:t,orientation:r,className:(0,n.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...i,children:(0,s.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});o.displayName=l.VM.displayName},371:(e,t,a)=>{"use strict";a.d(t,{T:()=>n});var s=a(5155),r=a(2115),l=a(9602);let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,l.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});n.displayName="Textarea"},9246:(e,t,a)=>{"use strict";a.d(t,{TooltipProvider:()=>i,ZI:()=>c,k$:()=>d,m_:()=>o});var s=a(5155),r=a(2115),l=a(9710),n=a(9602);let i=l.Kq,o=l.bL,d=l.l9,c=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...i}=e;return(0,s.jsx)(l.ZL,{children:(0,s.jsx)(l.UC,{ref:t,sideOffset:r,className:(0,n.cn)("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i})})});c.displayName=l.UC.displayName},241:(e,t,a)=>{"use strict";a.d(t,{dj:()=>u,oR:()=>m});var s=a(2115);let r=0,l=new Map,n=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?n(a):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],d={toasts:[]};function c(e){d=i(d,e),o.forEach(e=>{e(d)})}function m(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function u(){let[e,t]=s.useState(d);return s.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:m,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},9602:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l});var s=a(3463),r=a(9795);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},2120:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let s=a(2651).A.create({baseURL:"/api",timeout:3e4,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>e,e=>Promise.reject(e)),s.interceptors.response.use(e=>e,e=>(console.error("API Error:",e),Promise.reject(e)));let r=s}},e=>{var t=t=>e(e.s=t);e.O(0,[525,771,110,849,473,851,846,710,159,266,441,517,358],()=>t(7681)),_N_E=e.O()}]);